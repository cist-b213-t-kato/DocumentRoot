<html>

<head>

	<meta charset="UTF-8"/>

	<title>CIST非公式サイト</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script src="https://momentjs.com/downloads/moment.min.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link href="common.css" rel="stylesheet" />

</head>

<body>
	
  <div class="col-sm-12">
      <h1>CIST非公式サイト</h1>
      <p>裏サイトだと暗いイメージがあるので改名</p>
	<img src="dream/dream.cgi?id=index">
  </div>

  <div class="col-sm-12">
    <h2>シャトルバス</h2>
    <p>元のpdfは<a href="./shuttlebus.pdf">こちら</a>。以下のバス時刻表に間違いを見つけた人には飴ちゃんあげます。</p>
    <p>小型版は<a href="./shuttlebus.html">こちら</a>。</p>

    <div class="col-sm-12">
    	<span class="large highlight">現在時刻: <span id="crt"></span></span>
    </div>

    <div class="col-sm-6">
	    <h3>往路</h3>
	    <table>
	      <thead>
	      	<tr><th>千歳駅発</th><th>南千歳駅発</th><th>研究実験棟発</th><th>本部棟着</th></tr>
	      </thead>
	      <tbody id="ouro">
	      </tbody>
	    </table>
	  </div>

    <div class="col-sm-6">
	    <h3>復路</h3>
	    <table>
	      <thead>
	      	<tr><th>本部棟発</th><th>研究実験棟発</th><th>南千歳駅発</th><th>千歳駅着</th></tr>
	      </thead>
	      <tbody id="fukuro">
	      </tbody>
	    </table>
  	</div>

  	<div class="col-sm-12">
    	<!-- <p style="font-size:40px; font-weight:bold;"><a href="https://twitter.com/kagichan_kyun">カギちゃん</a>なんか必要ねえんだよ（宣戦布告）</p> -->
    	<p><span class="noriba2">朱色</span>は乗り場②</p>
    	<!-- <p>5/21 乗り場勘違いしてたせいで乗り遅れて30分くらい無駄にした・・・</p> -->
  	</div>
	</div>

  <!--div class="col-sm-12">
  	<h2>お知らせ</h2>

  	<h3>企画？ (2018.05.22)</h3>
  	<p>このサイトを使って「CISTわらしべ長者」をやりたい……勘のいい人はこの言葉だけでどんな企画か分かりそう</p>

  	<h3>スズメバチ (2018.05.21)</h3>
  	<p>3週間前くらいにスズメバチの女王を見ました。そろそろ増えてくる時期なので気をつけてください。</p>

  	<span class="old">
	  	<h3>PM2.5 (2018.04.28)</h3>
	  	<p>先日PM2.5の濃度が上がってたらしいのでこれで常時観察したい。。。配信元は<a href="http://www.tenki.jp/particulate_matter/1/">tenki.jp</a>。</p>
	  	<p>（追記）どうやら、<a href="https://www.sankei.com/life/news/180427/lif1804270035-n1.html">4/27にロシアで大規模な森林火災があり</a>、その際の煙が北海道まで舞ってきたらしい。</p>
  	</span>
  </div-->

  <div class="col-sm-12">
  	<h2>チャット</h2>
  	<p>調整中なので突然チャットが消えるかも。その時はすいません。自動更新もついてないので手動で更新してください。</p>
	  <form onsubmit="return false;">
		  <ul id="message"></ul>
	  	<div class="form-group" style="width:28%; margin-bottom:5px; display:inline-block;">
	  		名前: <input type="text" id="name" class="form-control" autocomplete="off">
	  	</div>
	  	<div class="form-group" style="width:55%; margin-bottom:5px; display:inline-block;">
		  	本文: <input type="text" id="body" class="form-control" autocomplete="off">
		  </div>
			<button id="outButton" class="text-center center-block btn btn-primary">送信</button>
		</form>
	</div>

  <div class="col-sm-6">
    <h2>プロメン成果物</h2>
    <h3>b216</h3>
    <ul>
        <!--<li><a href="./wicket-lecture">wicket-lecture</a></li>-->
        <li><a href="./trump">trump</a></li>
        <li><a href="./cist-cloud">cist-cloud</a></li>
    </ul>

    <h3>b215</h3>
    <ul>
        <li><a href="./PMPS">PMPS</a></li>
    </ul>

    <h3>m217</h3>
    <ul>
        <li><a href="./wicket-handson">wicket-handson</a></li>
        <li><a href="./ars">ars</a></li>
    </ul>
  </div>

  <div class="col-sm-6">
  	<h2>授業</h2>
  	<h3>情報科教育法</h3>
  	<ul>
  		<li><b><a href="./createjs_study1.pdf">【教科書】Create.jsを使ったデジタル数学教材作成1</a></b></li>
  		<li><b><a href="./createjs_study2.pdf">【教科書】Create.jsを使ったデジタル数学教材作成2</a></b></li>
  		<li><b><a href="./createjs_study3.pdf">【教科書】Create.jsを使ったデジタル数学教材作成3</a></b></li>
  		<li><b><a href="./createjs_template.zip">Create.jsのテンプレート(zipファイル)</a></b></li>
  		<li><a href="./wave.html">sin/cosを動かす</a></li>
  		<li><a href="./quantization1.html">量子化（ボタンとかなし）</a></li>
  		<li><a href="./quantization2.html">量子化（ボタンあり）</a></li>
  	</ul>
  	<h3>輪講</h3>
  	<ul>
  		<li><a href="http://a.co/5xFo4Y8">よしたかさんの輪講おすすめリスト（amazonのほしいものリスト）</a></li>
  	</ul>
  </div>

	<script type="text/javascript">

		// https://www.sejuku.net/blog/25316#Ajax
		
		function toDate( tStr ) {
			// TODO やはり文字<->日時変換のライブラリ必要と実感。。。
			var ret = moment();

			var h = Number(tStr.split(":")[0]); //( "00" + tStr ).substr(-5, 2);
			var m = Number(tStr.split(":")[1]); //( "00" + tStr ).substr(-2);

			ret.hours(h);
			ret.minute(m);
			ret.second(0);

			return ret;
		}

		function getFirst( times ) {
			for ( var i=0; i<times.length; i++ ) {
				if ( times[i] && times[i] != "" ) {
					return times[i];
				}
			}
			return ""; 
		}

		function getLast( times ) {
			for ( var i=times.length-1; i>=0; i-- ) {
				if ( times[i] && times[i] != "" ) {
					return times[i];
				}
			}
			return "";
		}

		function display( id , json ) {

			var crt = new moment();

			$(id).empty();

			var list = json.array;

			var late = true;

			for ( var j in list ) {
        
				var tr = $("<tr>");

				var times = list[j];

				var first = toDate(getFirst(times));
				var last = toDate(getLast(times));

				if ( late && crt <= first ) {
					tr.addClass("highlight");
					tr.addClass("large");
					late = false;
				}

				if ( crt >= first && crt <= last ) {
					tr.addClass("highlight");
				}

				for ( var i in times ) {

          var td = $("<td>");
					var t = times[i];
					if ( !t || t == "" ) {
            td.text("-");
					} else {
						td.text(t);
					}

					if ( i == 0 && json["noriba"] && json["noriba"][j] == "2" ) {
						td.addClass("noriba2");
					}

					tr.append(td);
				}
				$(id).append(tr);
			}
		}

		function viewMessage() {
			$.ajax({
		        type: 'GET',
		        url: 'http://54.92.8.231:3000/api',
		    }).done(function(data, dataType) {
					var message = $("#message");
					message.empty();
		    	for ( var i in data ) {
		      	var li = $("<li>");
		      	console.log(data[i].name + ": " + data[i].body);
				    li.text(data[i].name + ": " + data[i].body);
				    message.append(li);
		    	}
			    console.log('受信成功');
			}).fail(function(result) {
			    console.log('失敗');
			});
		}
		viewMessage();

		$('#outButton').click(function() {
			$.ajax({
				type: 'POST',
				url: 'http://54.92.8.231:3000/insert',
				data : {
					"name": $("#name").val(),
					"body": $("#body").val()
				}
	    }).done(function(result) {
			    console.log('送信成功');
			}).fail(function(result) {
			    console.log('失敗');
			});
			$("#body").val('');
			viewMessage();
		});

		function updates() {
			$('#crt').text(new moment().format('HH:mm'));
			var ouro = json["ouro"];
			var fukuro = json["fukuro"];
			display("#ouro", ouro);
			display("#fukuro", fukuro);
			viewMessage();			
		}

		$.ajax({
	    "url": "./shuttlebus.json",
	    "dataType": "json"
		}).done(function(json) {
			updates();

			setInterval(function() {
				updates();
			}, 1000*10);
		}).fail(function(data) {
	    console.log('ajax submit error!!!');
		});

	</script>

	<div class="col-sm-12" style="margin-bottom:100px;"></div>

</body>

</html>
