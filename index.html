<html>

<head>

	<meta charset="UTF-8"/>

	<title>CIST非公式サイト</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link href="common.css" rel="stylesheet" />

</head>

<body>
	
    <div class="col-sm-12">
        <h1>CIST非公式サイト</h1>
        <p>裏サイトだと暗いイメージがあるので改名</p>
    </div>

    <div class="col-sm-6">
        <h2>プロメン成果物</h2>
        <h3>b216</h3>
        <ul>
            <!--<li><a href="./wicket-lecture">wicket-lecture</a></li>-->
            <li><a href="./trump">trump</a></li>
            <li><a href="./cist-cloud">cist-cloud</a></li>
        </ul>

        <h3>b215</h3>
        <ul>
            <li><a href="./PMPS">PMPS</a></li>
        </ul>


        <h3>m217</h3>
        <ul>
            <li><a href="./wicket-handson">wicket-handson</a></li>
            <li><a href="./ars">ars</a></li>
        </ul>
    </div>

    <div class="col-sm-6">
    	<h2>授業</h2>
    	<h3>情報科教育法</h3>
    	<ul>
    		<li><b><a href="./createjs_study.pdf">【教科書】Create.jsを使ったデジタル数学教材作成</a></b></li>
    		<li><b><a href="./createjs_template.zip">Create.jsのテンプレート</a></b></li>
    		<li><a href="./wave.html">sin/cosを動かす</a></li>
    	</ul>
    	<h3>輪講</h3>
    	<ul>
    		<li><a href="http://a.co/5xFo4Y8">よしたかさんの輪講おすすめリスト（amazonのほしいものリスト）</a></li>
    	</ul>
    </div>

    <div class="col-sm-12">
	    <h2>シャトルバス</h2>
	    <p>小型版は<a href="./shuttlebus.html">こちら</a></p>
	    <div class="col-sm-6">
		    <h3>往路</h3>
		    <table>
		      <thead>
		      	<tr><th>千歳駅発</th><th>南千歳駅発</th><th>研究実験棟発</th><th>本部棟着</th></tr>
		      </thead>
		      <tbody id="ouro">
		      </tbody>
		    </table>
		  </div>

	    <div class="col-sm-6">
		    <h3>復路</h3>
		    <table>
		      <thead>
		      	<tr><th>本部棟発</th><th>研究実験棟発</th><th>南千歳駅発</th><th>千歳駅着</th></tr>
		      </thead>
		      <tbody id="fukuro">
		      </tbody>
		    </table>
	  	</div>

	  	<div class="col-sm-12">
	    	<p style="font-size:40px; font-weight:bold;"><a href="https://twitter.com/kagichan_kyun">カギちゃん</a>なんか必要ねえんだよ（宣戦布告）</p>
	  	</div>
  	</div>

    <div class="col-sm-12" style="margin-bottom: 100px;">
    	<h2>お知らせ</h2>
    	<h3>PM2.5分布予測</h3>
    	<p>先日PM2.5の濃度が上がってたらしいのでこれで常時観察したい。。。配信元は<a href="http://www.tenki.jp/particulate_matter/1/">tenki.jp</a>。</p>
    	<img src="http://az416740.vo.msecnd.net/static-images/particulate_matter/12/area_1/large.jpg" style="width:300px;"/>
    	<img src="http://az416740.vo.msecnd.net/static-images/particulate_matter/15/area_1/large.jpg" style="width:300px;"/>
    	<img src="http://az416740.vo.msecnd.net/static-images/particulate_matter/18/area_1/large.jpg" style="width:300px;"/>
    	<img src="http://az416740.vo.msecnd.net/static-images/particulate_matter/21/area_1/large.jpg" style="width:300px;"/>
    </div>

	<script type="text/javascript">

		// https://www.sejuku.net/blog/25316#Ajax
		
		function toDate( tStr ) {
			// TODO やはり文字<-->日時変換のライブラリ必要と実感。。。
			var crt = new Date();
			var dateStr = crt.getFullYear() + "/" + ("00"+(crt.getMonth()+1)).substr(-2)
									+ "/" + ( "00" + crt.getDate() ).substr(-2)
									+ " " + ( "00" + tStr).substr(-5)
									+ ":00";
			var ret = new Date(dateStr);
			return ret;
		}

		function getFirst( times ) {
			for ( var i=0; i<times.length; i++ ) {
				if ( times[i] && times[i] != "" ) {
					return times[i];
				}
			}
			return ""; 
		}

		function getLast( times ) {
			for ( var i=times.length-1; i>=0; i-- ) {
				if ( times[i] && times[i] != "" ) {
					return times[i];
				}
			}
			return "";
		}

		function display( id , json ) {


			// var crt = toDate("12:03");
			var crt = new Date();

			console.log(crt);
			console.log(toDate("12:03"));

			// var stopDate = toDate(json.array[1][3]);

			// console.log(toDate(json.array[0][3]) > crt);
			// console.log(toDate(json.array[1][3]) > crt);

			$(id).empty();

			// var list = [];
			// for ( var j in json.array ) {
			// 	if ( crt <= toDate(json.array[j][3]) ) {
			// 		list.push(json.array[j]);
			// 	}
			// }
			var list = json.array;

			var late = true;

			for ( var j in list ) {
        
				var tr = $("<tr>");

				var times = list[j];

				var first = toDate(getFirst(times));
				var last = toDate(getLast(times));

				// console.log(crt);

				if ( late && crt <= first ) {
					tr.addClass("highlight");
					tr.addClass("large");
					late = false;
				}

				if ( crt >= first && crt <= last ) {
					console.log("highlight");
					tr.addClass("highlight");
				}



				// var first = toDate(a[0]);
				// var last = toDate(a[a.length-1]);
				// var isBetween = first <= crt && last >= crt;

				// if ( latest == 1 ) {
				// 	latest = -1;
				// } else if ( latest !=-1 && crt <= first && latest == 0 ) {
				// 	latest = 1;
				// }

				// if ( latest == 1 || isBetween ) {
				// 	tr.addClass("highlight");
				// }

				for ( var i in times ) {

          var td = $("<td>");
					var t = times[i];
					if ( !t || t == "" ) {
            td.text("-");
					} else {
						td.text(t);
					}
					tr.append(td);
				}
				$(id).append(tr);
			}
		}

		// var dateStr = crt.getFullYear() + "-" + (crt.getMonth()+1) + "-" +crt.getDate()
		// 							+ " 16:10" + ":00"

		$.ajax({
	    "url": "./shuttlebus.json",
	    "dataType": "json"
		}).done(function(json) {
			var ouro = json["ouro"];
			var fukuro = json["fukuro"];

			display("#ouro", ouro);
			display("#fukuro", fukuro);

			setInterval(function() {
				display("#ouro", ouro);
				display("#fukuro", fukuro);
	            console.log("updated");
			}, 1000*60);
		}).fail(function(data) {
	    console.log('ajax submit error!!!');
		});


	</script>

</body>

</html>
